{{#section 'css'}}
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-countdown/2.1.0/css/jquery.countdown.min.css">
    <style>
        .strikeout {
            line-height: 1em;
            position: relative;
        }
        .strikeout::after {
            border-bottom: 0.125em solid red;
            content: "";
            left: 0;
            margin-top: calc(0.125em / 2 * -1);
            position: absolute;
            right: 0;
            top: 50%;
        }
        .carousel-control-prev-icon {
            background-image: url("data:image/svg+xml;charset=utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23000' viewBox='0 0 8 8'%3E%3Cpath d='M5.25 0l-4 4 4 4 1.5-1.5-2.5-2.5 2.5-2.5-1.5-1.5z'/%3E%3C/svg%3E") !important;
        }

        .carousel-control-next-icon {
            background-image: url("data:image/svg+xml;charset=utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23000' viewBox='0 0 8 8'%3E%3Cpath d='M2.75 0l-1.5 1.5 2.5 2.5-2.5 2.5 1.5 1.5 4-4-4-4z'/%3E%3C/svg%3E") !important;
        }

        #bidderInfo {
            border-collapse: collapse;
        }

        #bidderInfo td, #bidderInfo th {
            border: 1px solid #ddd;
            padding: 8px;
        }

        #bidderInfo tr:nth-child(even){background-color: #f2f2f2;}

        #bidderInfo tr:hover {background-color: #ddd;}

        #bidderInfo th {
            padding-top: 12px;
            padding-bottom: 12px;
            text-align: left;
            background-color: #c91e18;
            color: white;
        }
    </style>
{{/section}}
{{#section 'js'}}

    <script type="text/javascript" src="https://cdn.jsdelivr.net/gh/hilios/jQuery.countdown@2.0.4/dist/jquery.countdown.min.js"></script>
    <script>
        $(function(){
            $('[data-countdown]').each(function() {
                var $this = $(this), finalDate = $(this).data('countdown');
                $this.countdown(finalDate, function(event) {
                    $this.html(event.strftime('%D days %H:%M:%S'))}).on('finish.countdown', function() {
                });
            });
        });
    </script>
{{/section}}
<div class="card">
    <h4 class="card-header">
        {{this.product.ProName}}
        <!--Khang: Add to watch list-->
        {{#if auth}}
            {{#if this.product.isActive}}
                <div class="float-right">
                    <form action="/products/delWatchList" method="post">
                        <input type="hidden" name="ProID" value={{this.product.ProID}}>
                        <button class="btn btn-danger" type="submit">
                            <i class="fa fa-heart-o"></i>
                        </button>
                    </form>
                </div>
            {{else}}
                <div class="float-right">
                    <form action="/products/addWatchList" method="post">
                        <input type="hidden" name="ProID" value={{this.product.ProID}}>
                        <input type="hidden" name="ProStatus" value="detail">
                        <button class="btn btn-outline-danger" type="submit">
                            <i class="fa fa-heart-o"></i>
                        </button>
                    </form>
                </div>
            {{/if}}
        {{/if}}
        <!--Khang: Add to watch list-->
    </h4>
    <div class="card-body">
        <div class="row">
            <div class="col-md-6" style="padding-top: 20px">
                <div id="{{this.product.ProID}}" class="carousel slide" data-ride="carousel">
                    <div class="carousel-inner">
                        <div class="carousel-item active">
                            <img class="card-img-top" src="/public/imgs/sp/{{this.product.CatID1}}/{{this.product.CatID2}}/{{this.product.ProID}}/main.jpg" alt="{{ProName}}" title="{{this.product.ProName}}">
                        </div>
                        <div class="carousel-item">
                            <img class="card-img-top" src="/public/imgs/sp/{{this.product.CatID1}}/{{this.product.CatID2}}/{{this.product.ProID}}/main_1.jpg" alt="{{ProName}}" title="{{this.product.ProName}}">
                        </div>
                        <div class="carousel-item">
                            <img class="card-img-top" src="/public/imgs/sp/{{this.product.CatID1}}/{{this.product.CatID2}}/{{this.product.ProID}}/main_2.jpg" alt="{{ProName}}" title="{{this.product.ProName}}">
                        </div>
                    </div>
                    <button class="carousel-control-prev" type="button" data-target="#{{this.product.ProID}}" data-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="sr-only">Previous</span>
                    </button>
                    <button class="carousel-control-next" type="button" data-target="#{{this.product.ProID}}" data-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="sr-only">Next</span>
                    </button>
                </div>
                <div class="row justify-content-center row-cols-3" style="padding-left: 20px; padding-top: 30px">
                    <img  width="100%" height="100%" src="/public/imgs/sp/{{this.product.CatID1}}/{{this.product.CatID2}}/{{this.product.ProID}}/main.jpg" atl="{{this.product.ProName}}" title = "{{this.product.ProName}}">
                    <img  style="padding-left: 20px" width="100%" height="100%" src="/public/imgs/sp/{{this.product.CatID1}}/{{this.product.CatID2}}/{{this.product.ProID}}/main_1.jpg" atl="{{this.product.ProName}}" title = "{{this.product.ProName}}">
                    <img  style="padding-left: 20px" width="100%" height="100%" src="/public/imgs/sp/{{this.product.CatID1}}/{{this.product.CatID2}}/{{this.product.ProID}}/main_2.jpg" atl="{{this.product.ProName}}" title = "{{this.product.ProName}}">
                </div>
                <div class="card-body"n style="justify-items: center; text-align: center">
                    <h5 class="mt-3" style="text-decoration: underline; font-weight: bold">Thông tin đấu giá</h5>
                    <table id="bidderInfo" style="margin-left: auto; margin-right: auto">
                        <tr>
                            <th style="font-weight: lighter">Bidder</th>
                            <th style="font-weight: lighter">Giá vào</th>
                            <th style="font-weight: lighter">Người giữ giá</th>
                        </tr>
                        {{#each this.bidderInfo}}
                            <tr>
                                <td {{#if Status}}{{else}}class="strikeout"{{/if}}>{{MaskCharacter Username}}</td>
                                <td style="color: #c42e23">{{format_number Price}}</td>
                                <td {{#if Status}}{{else}}class="strikeout"{{/if}}>{{MaskCharacter HeaderUsername}}</td>
                                {{#if ../this.isOwner}}
                                <td>
                                    <div class="float-right">
                                        <form action="/products/denyRequest?ProID={{../this.proID}}&UserID={{UserID}}" method="post">
                                            <input type="hidden" name="ProID" value={{ProID}}>
                                            <button class="btn btn{{#if Status}}-outline-danger{{else}}-danger{{/if}}" type="submit">
                                                <i class="fa fa-trash-o"></i>
                                            </button>
                                        </form>
                                    </div>
                                </td>
                                {{/if}}
                            </tr>
                        {{/each}}
                    </table>
                </div>
            </div>
            <div class="col-md-6" style="text-align: justify-all; padding-top: 20px">
                <p class="card-text mt-4" style="font-size: 30px; text-align: center">
                    Giá hiện tại: <span class = "font-weight-bold text-danger" >{{format_number this.product.CurrentPrice}}</span>
                </p>
                <p class="card-text">
                    <div>
                        <i class="fa fa-user"></i>
                        <span>
                            Người bán:
                            <a href="/seller/ProductsOf/{{this.product.sellerUsername}}" style="color: #1747a6">{{this.product.sellerUsername}}
                                (<i class="fa fa-thumbs-up"></i>: {{this.UploadUserPoint.LikePoint}}/
                                <i class="fa fa-thumbs-down"></i>: {{this.UploadUserPoint.DislikePoint}})
                            </a>
                        </span>
                    </div>
                </p>
                <p class="card-text">
                    <i class="fa fa-arrow-up"></i>
                    <i class="fa fa-user"></i>
                    Bidder: <span class="card-title" style="font-weight: bold; color: #f0842b">{{this.highestBidder}}
                    (<i class="fa fa-thumbs-up"></i>: {{this.highestBidderPoint.LikePoint}}/
                    <i class="fa fa-thumbs-down"></i>: {{this.highestBidderPoint.DislikePoint}})</span>

                </p>
                <p class="card-text">
                    <i class="fa fa-money"></i>
                    <span style="font-weight: bold;">Mua ngay:</span>
                    {{#if this.product.PriceBuyNow}}
                        {{format_number this.product.PriceBuyNow}}
                    {{else}}
                        Không có
                    {{/if}}
                </p>


                <p class="card-text">
                    <i class="fa fa-clock-o"></i>
                    <span style="font-weight: bold">Ngày đăng:</span> {{formatDate this.product.UploadDate}}
                </p>
                <p class="card-text">
                    <span style="font-weight: bold"> <i class="fa fa-clock-o"></i>
                        Thời gian hết hạn:  </span>
                    <span class="card-title text-success" style="font-weight: bold" data-countdown="{{formatDateCountdown this.product.EndDate}}"></span>
                </p>
                <p style="font-weight: bold">Thông tin chi tiết: </p>
                <p class="card-text">
                    {{{this.product.TinyDes}}}
                </p>
                <p class="card-text">
                    {{{this.product.FullDes}}}
                </p>
                <p style="font-weight: bold; text-decoration: underline">Thông tin bổ sung</p>
                {{#each this.desHistory}}
                    <p><i class="fa fa-pencil"></i>
                        {{formatDate Time}}: {{Description}}
                    </p>
                {{/each}}
                {{#if isOwner}}
                    <div>
                        <form method="POST" action="/products/appendDescription/{{this.product.ProID}}">
                            <div class="search">
                                <input type="text" class="searchTerm" placeholder="Nhập thông tin bổ sung thêm" style="color: black" name="Info"required>
                                <button type="submit" class="searchButton">
                                    <i class="fa fa-check"></i>
                                </button>
                            </div>
                        </form>
                    </div>
                {{/if}}
            </div>
        </div>

        <h5 style="padding-top: 25px; font-weight: bold; text-decoration: underline; padding-bottom: 10px">Các sản phẩm liên quan:</h5>
        <div class="container">
            <div class="row" style="padding-left: 40px">
            {{#each this.list5Relate}}
                <div class="col-sm-2-1qtr mb-3">
                    <div class="card h-100">
                        <div id="{{ProID}}" class="carousel slide" data-ride="carousel">
                            <div class="carousel-inner">
                                <div class="carousel-item active">
                                    <img class="card-img-top" src="/public/imgs/sp/{{CatID1}}/{{CatID2}}/{{ProID}}/main.jpg" alt="{{ProName}}" title="{{ProName}}">
                                </div>
                                <div class="carousel-item">
                                    <img class="card-img-top" src="/public/imgs/sp/{{CatID1}}/{{CatID2}}/{{ProID}}/main_1.jpg" alt="{{ProName}}" title="{{ProName}}">
                                </div>
                                <div class="carousel-item">
                                    <img class="card-img-top" src="/public/imgs/sp/{{CatID1}}/{{CatID2}}/{{ProID}}/main_2.jpg" alt="{{ProName}}" title="{{ProName}}">
                                </div>
                            </div>
                            <button class="carousel-control-prev" type="button" data-target="#{{ProID}}" data-slide="prev">
                                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                <span class="sr-only">Previous</span>
                            </button>
                            <button class="carousel-control-next" type="button" data-target="#{{ProID}}" data-slide="next">
                                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                <span class="sr-only">Next</span>
                            </button>
                        </div>
                        <div class="card-body">
                            <p style="text-align: center" >{{ProName}}</p>
                        </div>
                        <div class="card-footer" style="justify-content: center; padding-top: 5px; align-items: center">
                            <div style="text-align: center">
                                <a class="btn btn-md btn-outline-primary" href="/products/detail/{{ProID}}" role="button">
                                    <i class="fa fa-eye"></i>
                                    Details
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                {{/each}}
            </div>
        </div>
    </div>
</div>